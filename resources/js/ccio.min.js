angular.module("ccioUser",["ccioUser.controllers"]);angular.module("ccioBilling",["ccioBilling.controllers"]);angular.module("ccioInvoice",["ccioInvoice.controllers"]);angular.module("ccioDashboard",["ccioDashboard.controllers"]);
angular.module("ccioCache",["ngRoute","ccioCache.controllers"]).config(["$routeProvider",function(a){a.when("/new",{templateUrl:"/dashboard/template/CacheNew",controller:"CacheNew"}).when("/edit",{templateUrl:"/dashboard/template/CacheEdit"}).when("/view",{templateUrl:"/dashboard/template/CacheView",controller:"CacheView"}).when("/progress",{templateUrl:"/dashboard/template/CacheView",controller:"CacheProgress"}).when("/card",{templateUrl:"/dashboard/template/PaymentNeeded"}).otherwise({templateUrl:"/dashboard/template/CacheDecide",
controller:"CacheDecide"})}]);"use strict";
angular.module("ccioBilling.controllers",["common.directives"]).controller("BillingCtrl",["$scope","$http",function(a,c){var b=!1,e=function(){c.get("/api/billing/creditcards").success(function(e){"success"===e.status?null!=e.cards?(a.creditcards=e.cards,b=!1):(a.creditcards=[],b=!0):(a.msgColor="danger",a.message=e.message,a.errors=e.messages);a.progress=!1;a.loading=!1}).error(function(){a.loading=!1;a.progress=!1;a.creditcards=[]})};a.loading=!1;a.msgColor="danger";a.creditcards=[];a.progress=
!0;e();a.showForm=function(){return!a.progress&&(b||0==a.creditcards.length)};a.save=function(){a.loading=!0;a.message=null;a.errors={};c.post("/api/billing/creditcard",a.billing).success(function(e){"error"===e.status?(a.errors=e.errors,a.message=e.message,a.msgColor="danger"):(b=!1,a.creditcards.push(e.card));a.loading=!1}).error(function(){a.loading=!1})};a.deleteCard=function(b){1<a.creditcards.length&&(a.loading=!0,a.message=null,a.errors={},c["delete"]("/api/billing/creditcard/"+b).success(function(b){"success"===
b.status?e():(a.msgColor="danger",a.message=b.message);a.loading=!1}).error(function(){a.loading=!1}))};a.setDafultCard=function(b){for(var d=0;d<a.creditcards.length;d++)if(a.creditcards[d].ccId==b&&!a.creditcards[d].defaultCard){c.put("/api/billing/creditcard/"+b+"/default").success(function(b){"success"===b.status?e():(a.msgColor="danger",a.message=b.message);a.loading=!1}).error(function(){a.loading=!1});break}};a.maskCard=function(a){return"American Express"==a.type?"**** ****** *"+a.last4:"Diners Club"==
a.type?"**** **** **"+a.last4[0]+a.last4[1]+" "+a.last4[2]+a.last4[3]:"**** **** **** "+a.last4};a.newCard=function(){a.billing={};a.message=null;b=!0};a.cancelForm=function(){a.billing={};a.message=null;b=!1}}]);"use strict";
angular.module("ccioCache.controllers",["common.directives","common.services"]).controller("CacheDecide",["$scope","$http","$location",function(a,c,b){c.get("/api/user/account").success(function(e){"success"===e.status?(a.setUser(e.user),null==e.user.stripeCustomerId?b.url("/card"):a.loadCaches()):a.message=e.message;a.loading=!1}).error(function(){a.loading=!1;a.message="Technical problem. Try again later."})}]).controller("CacheView",["$scope","$http","$location",function(a,c,b){a.loadCaches()}]).controller("CacheNew",
["$scope","$http","$location",function(a,c,b){a.newCluster()}]).controller("CacheProgress",["$scope","$http","$location",function(a,c,b){a.retrieveCacheUntilReady(a.cache.id)}]).controller("CacheCtrl",["$scope","$http","$location",function(a,c,b){jQuery("#destroyCluster").on("hide.bs.modal",function(b){jQuery("#thisIsOk").removeClass("has-error");a.thisIsOk=!1});a.caches=[];a.setUser=function(b){a.user=b};a.fieldsCheck=function(b){if(a.cache[b]){for(var c=!1,d=0;d<a.cache[b].length;d++)0<a.cache[b][d].value||
(c?a.cache[b].splice(d,1):c=!0);c||(a.cache[b][a.cache[b].length]={value:null})}else a.cache[b]=[{value:null}]};a.isUpdateDeleteDisabled=function(){return null==a.cache||null==a.cache.id||"ready"!=a.cache.status};a.isNewCacheDisabled=function(){return null==a.user||null==a.user.stripeCustomerId};a.newCluster=function(){b.url("/new");a.message=null;a.errors={};a.cache={origin:"s3",nodesNumber:2,allowedWidth:[{value:null}],allowedHeight:[{value:null}]}};a.editCluster=function(){b.url("/edit")};a.updateCluster=
function(){a.loading=!0;a.message=null;a.errors={};c.post("/api/cache/update",a.cache).success(function(e){console.log(e);"success"===e.status?(a.msgColor="success",a.cache=e.cache,a.fieldsCheck("allowedWidth"),a.fieldsCheck("allowedHeight"),b.url("/progress")):(a.errors=e.messages,a.msgColor="danger");a.message=e.message;a.loading=!1}).error(function(){a.msgColor="danger";a.loading=!1})};a.showDestroyCluster=function(){$("#destroyCluster").modal("show")};a.destroyCluster=function(){a.thisIsOk?(a.loading=
!0,a.message=null,c.get("/api/cache/destroy/"+a.cache.id).success(function(b){if("success"===b.status){for(var c=0;c<a.caches.length;c++)a.caches[c].id===a.cache.id&&(a.caches.splice(c,1),0<a.caches.length?a.showCache(0):a.newCluster());a.msgColor="success"}else a.errors=b.messages,a.msgColor="danger";a.message=b.message;a.loading=!1}).error(function(){a.msgColor="danger";a.loading=!1}),$("#destroyCluster").modal("hide")):jQuery("#thisIsOk").addClass("has-error")};a.createCluster=function(){a.loading=
!0;a.message=null;a.errors={};c.post("/api/cache/create",a.cache).success(function(e){console.log(e);if("success"===e.status){a.msgColor="success";for(var c=!1,d=0;d<a.caches.length;d++)if(a.caches[d].id===a.cache.id){c=!0;break}a.cache=e.cache;a.fieldsCheck("allowedWidth");a.fieldsCheck("allowedHeight");c||a.caches.push(a.cache);b.url("/progress")}else a.errors=e.messages,a.msgColor="danger";a.message=e.message;a.loading=!1}).error(function(){a.msgColor="danger";a.loading=!1})};a.showCache=function(e){a.message=
null;a.errors={};a.cache=a.caches[e];b.url("/view")};a.editCache=function(){a.fieldsCheck("allowedWidth");a.fieldsCheck("allowedHeight")};a.loadCaches=function(){c.get("/api/cache/list").success(function(b){"success"===b.status?(a.caches=b.caches,0<b.caches.length?(a.showCache(0),a.fieldsCheck("allowedWidth"),a.fieldsCheck("allowedHeight"),a.retrieveCacheUntilReady(a.cache.id)):a.newCluster(),a.msgColor="success"):(a.errors=b.messages,a.msgColor="danger");a.message=b.message;a.loading=!1}).error(function(){a.msgColor=
"danger";a.loading=!1})};a.loadCache=function(b){a.loading=!0;a.message=null;a.errors={};c.get("/api/cache/retrieve/"+b).success(function(c){if("success"===c.status){for(var d=0;d<a.caches.length;d++)a.caches[d].id==b&&(a.caches[d]=c.cache,a.cache.id==c.cache.id&&(a.cache=a.caches[d]));a.msgColor="success"}else a.errors=c.messages,a.msgColor="danger";a.message=c.message;a.loading=!1}).error(function(){a.msgColor="danger";a.loading=!1})};a.retrieveCacheUntilReady=function(b){null!=a.timer&&clearTimeout(a.timer);
for(var c=0;c<a.caches.length;c++)if(a.caches[c].id==b){var d=a.caches[c];null!=d&&"ready"!=d.status&&"deleted"!=d.status&&(a.loadCache(b),a.timer=setTimeout(function(){a.retrieveCacheUntilReady(b)},1E4))}}}]);"use strict";
angular.module("ccioDashboard.controllers",["common.directives"]).controller("DashboardCtrl",["$scope","$http",function(a,c){a.data={balanceCents:"--",clusterCount:"--",nodeCount:"--"};a.timePeriodLabel="Last 24 hours";a.chart=Morris.Area({element:"line-chart",data:[],xkey:"period",ykeys:["fromStorage","toCdn"],labels:["Traffic from Origin","Traffic to CDN"],lineColors:["#dd301b","#5cb85c"],pointSize:3,resize:!0,hideHover:"auto"});c.get("/api/cache/dashboard").success(function(b){console.log(b);"success"===
b.status?a.data=b:(a.msgColor="danger",a.message=b.message)}).error(function(){});a.last24hours=function(){c.get("/api/analytics/clusters/efficiency/last/24hours").success(function(b){if("success"===b.status){a.data.clusters=b.clusters;a.chart.setData(b.data);var c=0,f=0,d;for(d in b.data)c+=b.data[d].fromStorage,f+=b.data[d].toCdn;a.fromOrigin=c;a.toCdn=f}else a.msgColor="danger",a.message=b.message}).error(function(){});a.timePeriodLabel="Last 24 hours"};a.lastWeek=function(){c.get("/api/analytics/clusters/efficiency/last/week").success(function(b){if("success"===
b.status){a.data.clusters=b.clusters;a.chart.setData(b.data);var c=0,f=0,d;for(d in b.data)c+=b.data[d].fromStorage,f+=b.data[d].toCdn;a.fromOrigin=c;a.toCdn=f}else a.msgColor="danger",a.message=b.message}).error(function(){});a.timePeriodLabel="Last week"};a.lastMonth=function(){c.get("/api/analytics/clusters/efficiency/last/month").success(function(b){if("success"===b.status){a.data.clusters=b.clusters;a.chart.setData(b.data);var c=0,f=0,d;for(d in b.data)c+=b.data[d].fromStorage,f+=b.data[d].toCdn;
a.fromOrigin=c;a.toCdn=f}else a.msgColor="danger",a.message=b.message}).error(function(){});a.timePeriodLabel="Last month"};a.lastYear=function(){c.get("/api/analytics/clusters/efficiency/last/year").success(function(b){if("success"===b.status){a.data.clusters=b.clusters;a.chart.setData(b.data);var c=0,f=0,d;for(d in b.data)c+=b.data[d].fromStorage,f+=b.data[d].toCdn;a.fromOrigin=c;a.toCdn=f}else a.msgColor="danger",a.message=b.message}).error(function(){});a.timePeriodLabel="Last year"};a.centsToMoney=
function(a){return isNaN(a)?"--":"$"+(a/100).toFixed(2)};a.trafficToBytes=function(a){if(isNaN(a))return"--";var c="Mb";0<Math.floor(a/1024)&&(a=Math.round(a/1024),c="Gb");0<Math.floor(a/1024)&&(a=Math.round(a/1024),c="Tb");return a.toLocaleString()+c};a.last24hours()}]);"use strict";
angular.module("common.directives",[]).directive("ccioMenuClick",["$location","$route",function(a,c){return{restrict:"A",link:function(a,c,f){c.bind("click",function(){window.location.href=c[0].href})}}}]).directive("ccioLoading",function(){return{restrict:"A",link:function(a,c,b){a.$watch(b.ccioLoading,function(a,b){if(a!==b){var d=jQuery(c);a?(d.attr("disabled","disabled"),d.addClass("loading")):(d.removeAttr("disabled"),d.removeClass("loading"))}})}}}).directive("ccioPopupClose",function(){return{restrict:"A",
link:function(a,c,b){var e=b.ccioPopupClose,f=function(b){var g=!1,h=jQuery(c);jQuery(b.target).parents().andSelf().each(function(){if(-1!=jQuery.inArray(this,h))return g=!0,!1});g||(setTimeout(function(){jQuery(document).unbind("click",f)},0),a.$apply(e))};a.$watch(b.ccioShow,function(a,b){a!==b&&(a?setTimeout(function(){jQuery(document).bind("click",f)},0):setTimeout(function(){jQuery(document).unbind("click",f)},0))})}}}).directive("ccioError",function(){return{restrict:"A",link:function(a,c,b){b=
b.ccioError;c=jQuery(c);var e=a.$eval(b),f=function(a){angular.isDefined(a)?(c.addClass("has-error"),c.attr("data-original-title",a),c.tooltip({container:"body"})):(c.removeClass("has-error"),c.tooltip("destroy"),c.removeAttr("data-original-title"))};f(e);a.$watch(b,function(a,b){a!==b&&f(a)})}}}).directive("ccioShow",function(){return{restrict:"A",link:function(a,c,b){var e=b.ccioShow,f=b.slideDuration||"fast";c=jQuery(c);a.$eval(e)||c.hide();a.$watch(e,function(a,b){a!==b&&(c.css("top",jQuery(document).scrollTop()+
jQuery("#top-bar").outerHeight()),a?c.stop(!0,!0).slideDown(f):c.stop(!0,!0).slideUp(f))})}}}).directive("ccioHelp",function(){return{restrict:"A",link:function(a,c,b){c=jQuery(c);c.addClass("help");c.popover({html:!0,container:"body"}).click(function(a){return!1});jQuery("html").on("click",function(a){"undefined"!=typeof jQuery(a.target).data("data-original-title")||jQuery(a.target).parents().is(".popover.in")||(jQuery("[data-original-title]").popover("hide"),jQuery(".popover").remove())})}}});"use strict";
angular.module("fnbEditorDep",[]).filter("interpolate",["version",function(a){return function(c){return String(c).replace(/\%VERSION\%/mg,a)}}]);"use strict";
angular.module("ccioInvoice.controllers",["common.directives"]).controller("InvoiceCtrl",["$scope","$http",function(a,c){c.get("/api/invoice/init").success(function(b){"success"===b.status?(a.dates=b.dates,a.user=b.user):(a.msgColor="danger",a.message=b.message,a.errors=b.messages)}).error(function(){});a.loadInvoice=function(b){a.date=b;a.invoice=[];c.get("/api/invoice/"+b).success(function(b){"success"===b.status?(b.invoice.sort(function(a,b){return a.date-b.date}),a.invoice=b.invoice):(a.msgColor=
"danger",a.message=b.message,a.errors=b.messages);a.loading=!1}).error(function(){a.loading=!1})};a.centsToMoney=function(a){return"$"+(a/100).toFixed(2)};a.mlsecToDate=function(a){return(new Date(a)).toLocaleDateString()};a.periodLabel=function(){if(null==a.date||"current"===a.date)return"Current";var b=a.date.substring(2,6),c=a.date.substring(0,2);return a.monthLabel(c)+" "+b};a.monthLabel=function(a){switch(a){case "01":return"January";case "02":return"February";case "03":return"March";case "04":return"April";
case "05":return"May";case "06":return"June";case "07":return"July";case "08":return"August";case "09":return"September";case "10":return"October";case "11":return"November";case "12":return"December"}};a.loadInvoice("current")}]);"use strict";angular.module("common.services",[]).factory("loggedUser",function(){var a=null;return{getUser:function(){return a},setUser:function(c){a=c}}});"use strict";
angular.module("ccioUser.controllers",["common.directives"]).controller("UserCtrl",["$scope","$http",function(a,c){a.user={};a.loading=!1;a.msgColor="danger";a.login=function(){a.loading=!0;a.message=null;a.errors={};c.post("/api/user/login",a.user).success(function(b){"success"===b.status?"undefined"==typeof b.dsName?window.location="/dashboard":window.location.reload():(a.message=b.message,a.errors=b.messages);a.loading=!1}).error(function(){a.loading=!1})};a.register=function(){a.loading=!0;a.message=
null;a.errors={};c.post("/api/user/register",a.user).success(function(b){"success"===b.status?"undefined"==typeof b.dsName?window.location="/dashboard":window.location.reload():(a.message=b.message,a.errors=b.messages);a.loading=!1}).error(function(){a.loading=!1})};a.resetPassword=function(){a.loading=!0;a.message=null;a.errors={};c.post("/api/user/resetPassword",a.user).success(function(b){"success"===b.status?(a.msgColor="success",a.errors={}):(a.msgColor="danger",a.errors=b.messages);a.message=
b.message;a.loading=!1}).error(function(){a.loading=!1;a.msgColor="danger"})};a.sendConfirmation=function(){a.loading=!0;a.message=null;c.get("/api/user/sendConfirmation").success(function(b){a.msgColor="success"===b.status?"success":"danger";a.message=b.message;a.loading=!1}).error(function(){a.loading=!1})}}]).controller("AccountCtrl",["$scope","$http",function(a,c){a.user={};a.loading=!1;a.msgColor="danger";a.confirmPassword=null;jQuery(".help").popover();c.get("/api/user/account").success(function(b){"success"===
b.status?a.user=b.user:(a.message=b.message,a.errors=b.messages);a.loading=!1}).error(function(){a.loading=!1});a.update=function(){a.loading=!0;a.message=null;a.errors={};c.post("/api/user/account",a.user).success(function(b){"success"===b.status?(a.message=b.message,a.msgColor="success"):(a.message=b.message,a.errors=b.messages,a.msgColor="danger");a.loading=!1}).error(function(){a.loading=!1;a.msgColor="danger"})};a.updatePassword=function(){a.confirmPassword==a.user.password?a.update():a.errors.confirmPassword=
"Not the same"};a.passwordHelp=function(){jQuery(".help").popover("toggle")}}]);